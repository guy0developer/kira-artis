<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kira Artış Hesaplayıcı (TÜFE) — developed by eylmz</title>
  <meta name="description" content="Mevcut kira üzerinden, son açıklanan TÜFE (aylık %) oranına göre yeni kira tutarını hesaplayın. Basit, hızlı, gizlilik dostu." />
  <meta name="robots" content="index,follow" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏠</text></svg>">
  <style>
    :root{
      --bg: #0b0c10;
      --card:#111317;
      --muted:#676b76;
      --text:#e9eef5;
      --brand:#7c5cff;
      --ok:#1db954;
      --warn:#ffb020;
      --err:#ff5468;
      --ring: rgba(124,92,255,.35);
    }
    @media (prefers-color-scheme: light) {
      :root{
        --bg:#f7f8fb;
        --card:#ffffff;
        --muted:#667085;
        --text:#101828;
        --brand:#6c47ff;
        --ok:#12a150;
        --warn:#b7791f;
        --err:#d6455d;
        --ring: rgba(108,71,255,.25);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    /* ▼ Mobilde yukarıdaki boşluğu kaldır, desktop'ta ortala */
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#0e0f13);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
      color:var(--text);
      min-height:100svh; /* mobil tarayıcı çubuklarına duyarlı */
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    @media (max-width: 719px){
      body{ align-items:flex-start; padding:16px 16px 24px; }
      .card{ margin-top:8px; }
    }

    .wrap{width:min(760px,100%); margin-inline:auto}
    .card{
      background:var(--card); border:1px solid rgba(255,255,255,.06);
      border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.25);
      padding:22px;
    }
    h1{font-weight:800; font-size:clamp(20px,3.4vw,28px); margin:0 0 8px}
    .sub{color:var(--muted); margin:0 0 18px}
    .grid{display:grid; gap:14px}
    @media (min-width:720px){ .grid.cols-2{grid-template-columns:1fr 1fr} }
    label{display:block; font-weight:600; margin:8px 0 6px}
    .row{display:flex; gap:10px; align-items:center}
    .in{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0f1116; color:var(--text);
      outline:none; transition:.2s border-color,.2s box-shadow,.2s background;
    }
    @media (prefers-color-scheme: light){ .in{background:#f2f4f7; border-color:#e5e7eb} }
    .in:focus{border-color:var(--brand); box-shadow:0 0 0 6px var(--ring)}
    .btn{
      border:0; padding:12px 14px; border-radius:12px; font-weight:700; cursor:pointer;
      background:var(--brand); color:white; transition:transform .05s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:transparent; color:var(--text); border:1px dashed rgba(255,255,255,.2)}
    .meta{font-size:13px; color:var(--muted)}
    .res{
      margin-top:14px; border-radius:14px; padding:14px; background:linear-gradient(180deg,rgba(124,92,255,.12),transparent);
      border:1px solid rgba(124,92,255,.25);
    }
    .kv{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center}
    .kv b{font-size:clamp(18px,3vw,22px)}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:rgba(255,255,255,.06); color:var(--muted); font-size:13px}
    .ok{color:var(--ok)}
    .warn{color:var(--warn)}
    .err{color:var(--err)}
    footer{margin-top:14px; text-align:center; color:var(--muted); font-size:13px}
    .copy{font-size:13px; cursor:pointer; color:var(--brand); border:0; background:transparent}
    .source{font-size:12px; color:var(--muted)}
  </style>

  <!-- SEO: Calculator schema -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Calculator",
    "name":"Kira Artış Hesaplayıcı (TÜFE)",
    "description":"Mevcut kira tutarı için, TÜFE (12 Aylık Ortalama %) oranına göre zamlı kira hesaplama.",
    "provider":{"@type":"Organization","name":"eylmz"}
  }
  </script>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>Kira Artış (TÜFE) Hesaplayıcı</h1>
      <p class="sub">Mevcut kirayı girin, <strong>son açıklanan TÜFE (12 Aylık Ortalama %)</strong> ile yeni kira tutarını görün.</p>

      <div class="grid cols-2" role="form" aria-label="Kira artış formu">
        <div>
          <label for="rent">Mevcut Kira (TL)</label>
          <input id="rent" class="in" type="number" inputmode="decimal" min="0" step="0.01" placeholder="Örn: 15.000" />
        </div>

        <div>
          <label for="rate">Artış Oranı (TÜFE 12 Ay Ort. %) <span class="meta"></span></label>
          <!-- ▼ Buton ve extra row kaldırıldı; iki input aynı hizada -->
          <input id="rate" class="in" type="number" inputmode="decimal" step="0.01" placeholder="Örn: 2.06" />
        </div>
      </div>

      <div class="row" style="margin-top:10px; gap:8px">
        <button id="calc" class="btn">Hesapla</button>
        <button id="reset" class="btn secondary">Temizle</button>
        <span id="stamp" class="pill" aria-live="polite" title="Veri damgası" style="display:none"></span>
      </div>

      <section id="result" class="res" style="display:none">
        <div class="kv">
          <div>Yeni Kira</div>
          <b id="newRent">—</b>
          <div>Artış Oranı</div>
          <b id="rateShow">—</b>
          <div>Artış Tutarı</div>
          <b id="inc">—</b>
        </div>
        <div class="row" style="margin-top:8px; justify-content:space-between">
          <span class="source" id="src">Kaynak: —</span>
          <button id="copy" class="copy" aria-label="Sonucu kopyala">Kopyala</button>
        </div>
      </section>

      <footer>
        developed by <b>eylmz</b>
      </footer>
    </section>
  </main>

  <script>
    const fmtTL = (n) => new Intl.NumberFormat('tr-TR', { style:'currency', currency:'TRY', maximumFractionDigits:0 }).format(n);
    const fmtPct = (n) => `${Number(n).toLocaleString('tr-TR', {maximumFractionDigits:2})}%`;

    const el = (id)=>document.getElementById(id);
    const rent = el('rent'), rate = el('rate');
    const btnCalc = el('calc'), btnReset = el('reset'), stamp = el('stamp');
    const result = el('result'), newRent = el('newRent'), inc = el('inc'), rateShow = el('rateShow');
    const copyBtn = el('copy'), src = el('src');

    async function getLatestTufeMonthly() {
      try {
        const r = await fetch('/api/tufe/latest', { headers: { 'Accept':'application/json' }, cache:'no-store' });
        if (!r.ok) throw new Error('bad');
        const j = await r.json(); // {period, avg12_pct, monthly_pct, yoy_pct, ...}

        // Öncelik: 12 ay ortalama; yoksa (fallback) yıllık; o da yoksa aylık
        const chosen =
          typeof j.avg12_pct === 'number' ? j.avg12_pct :
          typeof j.yoy_pct   === 'number' ? j.yoy_pct   :
          typeof j.monthly_pct === 'number' ? j.monthly_pct : null;

        if (chosen != null) {
          rate.value = Number(chosen).toFixed(2);

          // >>> ekle: hangi metriğin kullanıldığını yaz
          const metricLabel =
            typeof j.avg12_pct === 'number' ? 'TÜFE (12 ay ort.)' :
            typeof j.yoy_pct   === 'number' ? 'TÜFE (yıllık)' :
            'TÜFE (aylık)';

          stamp.style.display='inline-flex';
          stamp.textContent = `Son veri: ${j.period} • ${metricLabel}`;
          src.textContent = j.source || 'TÜİK/TCMB';
          return;
        }
        throw new Error('empty');
      } catch (e) {
        stamp.style.display='inline-flex';
        stamp.textContent = 'Oran otomatik çekilemedi • Manuel girebilirsiniz';
        src.textContent = '—';
      }
    }

    function calculate() {
      const r = parseFloat((rent.value||'').toString().replace(',', '.'));
      const p = parseFloat((rate.value||'').toString().replace(',', '.'));
      if (Number.isNaN(r) || r <= 0) { alert('Lütfen geçerli bir kira tutarı girin.'); return; }
      if (Number.isNaN(p)) { alert('Oran boş. Lütfen manuel girin ya da daha sonra tekrar deneyin.'); return; }
      const incAmt = r * (p/100);
      const newAmt = r + incAmt;
      result.style.display='block';
      newRent.textContent = fmtTL(newAmt);
      inc.textContent = fmtTL(incAmt);
      rateShow.textContent = fmtPct(p);
    }

    function resetAll(){
      rent.value=''; rate.value='';
      result.style.display='none'; stamp.style.display='none';
      src.textContent='—';
    }

    btnCalc.addEventListener('click', calculate);
    btnReset.addEventListener('click', resetAll);

    copyBtn.addEventListener('click', async () => {
      if (result.style.display!=='none') {
        const txt = `Yeni kira: ${newRent.textContent} • Artış oranı: ${rateShow.textContent} • Artış tutarı: ${inc.textContent}`;
        try { await navigator.clipboard.writeText(txt); copyBtn.textContent='Kopyalandı ✓'; setTimeout(()=>copyBtn.textContent='Kopyala',1200); }
        catch { /* no-op */ }
      }
    });

    // Sayfa açılınca oranı otomatik al
    getLatestTufeMonthly();
  </script>
</body>
</html>
